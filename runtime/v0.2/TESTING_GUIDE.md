# IKDD Runtime v0.2 â€” Testing Guide

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€IKDD Runtime v0.2ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰AIå‹•ä½œã‚’åŒ…æ‹¬çš„ã«ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

IKDD Runtime v0.2ã¯ä»¥ä¸‹ã®è¦ç´ ã‚’çµ„ã¿åˆã‚ã›ãŸ**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

1. **ğŸ“š Human Knowledge** â€” äººé–“ãŒä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼ˆknowledge.yamlï¼‰
2. **ğŸ¤– AI Generation** â€” AIã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆAnthropic Claude or Dummyï¼‰
3. **âœ… CDD Validation** â€” åˆ¶ç´„é§†å‹•é–‹ç™ºã«ã‚ˆã‚‹å“è³ªä¿è¨¼ï¼ˆconstraints.pyï¼‰

```
Knowledge Base + AI Provider + CDD Constraints = Quality Code
```

## ğŸ“Š 3ã¤ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1ï¸âƒ£ è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆAPIã‚­ãƒ¼ä¸è¦ï¼‰

æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã€‚APIæ¥ç¶šãªã—ã§å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
python test_generated_code.py
```

**å®Ÿè¡Œå†…å®¹ï¼š**
- âœ… dummyãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
- âœ… CDDåˆ¶ç´„ã®æ¤œè¨¼ï¼ˆmust_use, forbidden_modules, immutable_paramsï¼‰
- âœ… ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
- âœ… å‡ºåŠ›çµæœã®æ¤œè¨¼

**å‡ºåŠ›ä¾‹ï¼š**
```
============================================================
IKDD Runtime v0.2 â€” Validation Test Suite
============================================================
ğŸ”„ Step 1: Testing code generation...
âœ… Code generation successful

ğŸ”„ Step 2: Testing constraint validation...
âœ… All constraints satisfied

ğŸ”„ Step 3: Testing code execution...
âœ… Code execution successful
   Filtered 3 rows with score >= 50

============================================================
Test Results: 3/3 passed
============================================================
```

### 2ï¸âƒ£ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢ï¼ˆAPIã‚­ãƒ¼ä¸è¦ï¼‰

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä»•çµ„ã¿ã‚’æ®µéšçš„ã«ç†è§£ã§ãã¾ã™ã€‚

```bash
python demo_hybrid_mode.py
```

**å†…å®¹ï¼š**
- ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å¯è¦–åŒ–
- ğŸ“š ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®èª¬æ˜
- ğŸ”§ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆçµ„ã¿ç«‹ã¦ã®ä»•çµ„ã¿
- âœ… CDDåˆ¶ç´„ã®æ¤œè¨¼æ–¹æ³•
- ğŸ¤– ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ
- ğŸ§ª ãƒ©ã‚¤ãƒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### 3ï¸âƒ£ å®Ÿéš›ã®AIç”Ÿæˆãƒ†ã‚¹ãƒˆï¼ˆAPIã‚­ãƒ¼å¿…è¦ï¼‰

Anthropic Claude APIã‚’ä½¿ç”¨ã—ãŸå®Ÿéš›ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
# 1. anthropicãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install anthropic

# 2. APIã‚­ãƒ¼ã‚’è¨­å®š
export ANTHROPIC_API_KEY="your-api-key-here"

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python test_hybrid_mode.py
```

**å®Ÿè¡Œå†…å®¹ï¼š**
- ğŸ“š knowledge.yamlã‹ã‚‰äººé–“ä½œæˆã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿
- ğŸ”§ tool.yamlã®intent/flow/constraintsã¨çµ„ã¿åˆã‚ã›ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
- ğŸ¤– Anthropic Claude APIã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé€ä¿¡ï¼ˆclaude-3-5-sonnet-20241022ï¼‰
- ğŸ“ AIãŒç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å—ä¿¡
- âœ… CDDåˆ¶ç´„ã«ã‚ˆã‚‹å“è³ªæ¤œè¨¼
- ğŸ”„ åˆ¶ç´„é•åãŒã‚ã‚Œã°è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆmax_tries=2ï¼‰
- ğŸ§ª ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œãƒ†ã‚¹ãƒˆ

## ğŸ” ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ

```bash
# dummyã®ã¿ãƒ†ã‚¹ãƒˆ
python compare_providers.py dummy

# dummyã¨anthropicã‚’æ¯”è¼ƒï¼ˆAPIã‚­ãƒ¼å¿…è¦ï¼‰
python compare_providers.py dummy anthropic
```

**æ¯”è¼ƒé …ç›®ï¼š**
- âœ… ç”ŸæˆæˆåŠŸ/å¤±æ•—
- âœ… å®Ÿè¡ŒæˆåŠŸ/å¤±æ•—
- âœ… ã‚³ãƒ¼ãƒ‰è¡Œæ•°
- âœ… å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã®å·®ç•°

## ğŸ“¨ AIã«é€ä¿¡ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç¢ºèª

å®Ÿéš›ã«Anthropicã«é€ä¿¡ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç¢ºèªã§ãã¾ã™ï¼š

```bash
python -c "
from ikdd.prompt import load_tool, load_knowledge, assemble_prompt
tool = load_tool('tool.yaml')
kn = load_knowledge('knowledge.yaml')
prompt = assemble_prompt(tool, kn)
print(prompt)
"
```

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹æˆï¼š**
```
ã‚ãªãŸã¯ code generator ã§ã™ã€‚
tool intent ã«å¾“ã„ã€flow ã®é †åºã§ã€knowledge snippet ã‚’å‚è€ƒã«å®Ÿè£…ã—ãªã•ã„ã€‚

# intent
WHAT: CSV ã®ä¸­ã‹ã‚‰æ¡ä»¶ã«åˆã†è¡Œã‚’æŠ½å‡ºã—ã¦ JSON ã«å‡ºåŠ›ã™ã‚‹
WHY : æ‰‹ä½œæ¥­ã® Excel ãƒ•ã‚£ãƒ«ã‚¿ãŒæ™‚é–“ã®ç„¡é§„

# flow (é †åºå³å®ˆ)
1. CSV_LOAD  input=['csv_file']  output=rows
2. FILTER_ROWS  input=['rows', 'filter_column', 'threshold']  output=filtered
3. JSON_EXPORT  input=['filtered', 'json_file']  output=None

# åˆ¶ç´„ (CDD)
- å¿…ãšã“ã®è­˜åˆ¥å­/é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹: ['CSV_LOAD', 'FILTER_ROWS', 'JSON_EXPORT']
- ä½¿ã£ã¦ã¯ãªã‚‰ãªã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: ['pandas']
- å€¤ã‚’å¤‰æ›´ã—ã¦ã¯ãªã‚‰ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å: ['filter_column', 'threshold']

# å‡ºåŠ›ä»•æ§˜
- 1ã¤ã® Python ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆé–¢æ•°åã¯ `csv_filter_exporter` ã¨ã™ã‚‹
- ä¾å­˜ã™ã‚‹è£œåŠ©é–¢æ•°ã¯åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«å®šç¾©ã™ã‚‹
- ä½™è¨ˆãªèª¬æ˜æ–‡ã¯å‡ºåŠ›ã—ãªã„ã€‚ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’è¿”ã™

# knowledge snippets
### CSV_LOAD
[äººé–“ãŒä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ]
### FILTER_ROWS
[äººé–“ãŒä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ]
### JSON_EXPORT
[äººé–“ãŒä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ]
```

## ğŸ†š Dummy vs Anthropic ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

| é …ç›® | Dummy Provider | Anthropic Provider |
|------|----------------|-------------------|
| **APIã‚­ãƒ¼å¿…è¦** | âŒ ä¸è¦ | âœ… å¿…è¦ |
| **å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯** | âŒ ä¸è¦ | âœ… å¿…è¦ |
| **AIæ¨è«–** | âŒ ãªã— | âœ… ã‚ã‚Š |
| **ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ´»ç”¨** | âš ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | âœ… ç†è§£ã—ã¦ä½¿ç”¨ |
| **è¦ä»¶ã¸ã®é©å¿œ** | âŒ ä¸å¯ | âœ… å¯èƒ½ |
| **CDDæ¤œè¨¼** | âœ… ã‚ã‚Š | âœ… ã‚ã‚Š |
| **å‡ºåŠ›å“è³ª** | âœ… è‰¯å¥½ | âœ… å„ªç§€ |
| **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹** | ãƒ†ã‚¹ãƒˆ/CI | æœ¬ç•ªç”Ÿæˆ |

### Dummy Providerã®ç‰¹å¾´
- âœ… ãƒ†ã‚¹ãƒˆã¨CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«æœ€é©
- âœ… å¤–éƒ¨ä¾å­˜ãªã—
- âœ… é«˜é€Ÿã§æ±ºå®šçš„
- âœ… ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆãŸã ã—CDDæº–æ‹ ï¼‰

### Anthropic Providerã®ç‰¹å¾´
- âœ… è¦ä»¶ã‚’çœŸã«ç†è§£
- âœ… ç•°ãªã‚‹toolå®šç¾©ã«é©å¿œ
- âœ… Claudeã®æ¨è«–èƒ½åŠ›ã‚’æ´»ç”¨
- âœ… APIã‚­ãƒ¼å¿…è¦: https://console.anthropic.com/

## ğŸ”§ CDDåˆ¶ç´„ã®è©³ç´°

### 1. MustUseRule
```python
# å¿…é ˆè­˜åˆ¥å­ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
must_use = ["CSV_LOAD", "FILTER_ROWS", "JSON_EXPORT"]
```
- AIãŒãƒŠãƒ¬ãƒƒã‚¸ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ç¢ºå®Ÿã«ä½¿ç”¨
- äººé–“ã®çŸ¥è­˜ã‚’æ´»ã‹ã™

### 2. ForbiddenModulesRule
```python
# ç¦æ­¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½¿ç”¨ã‚’é˜²æ­¢
forbidden_modules = ["pandas"]
```
- ä¸è¦ãªä¾å­˜ã‚’æ’é™¤
- ASTãƒ‘ãƒ¼ã‚¹ã§ç¢ºå®Ÿã«æ¤œå‡º

### 3. ImmutableParamsRule
```python
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´ã‚’é˜²æ­¢
immutable_params = ["filter_column", "threshold"]
```
- é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶
- äºˆæœŸã—ãªã„å‰¯ä½œç”¨ã‚’é˜²æ­¢

## âš™ï¸ åˆ¶ç´„é•åæ™‚ã®å‹•ä½œ

```
1. AIç”Ÿæˆ â†’ åˆ¶ç´„ãƒã‚§ãƒƒã‚¯ â†’ âŒ é•åæ¤œå‡º

2. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”Ÿæˆ:
   "å‰å›ã®å•é¡Œç‚¹ã‚’ä¿®æ­£:
    - [MustUse] Identifier not found: CSV_LOAD
    - [ForbiddenModules] Forbidden import detected: pandas"

3. ä¿®æ­£ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé€ä¿¡ â†’ AIå†ç”Ÿæˆ â†’ åˆ¶ç´„ãƒã‚§ãƒƒã‚¯ â†’ âœ… åˆæ ¼

æœ€å¤§2å›ã¾ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆmax_tries=2ï¼‰
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰

### APIã‚­ãƒ¼ãªã—ã§ãƒ†ã‚¹ãƒˆ
```bash
cd runtime/v0.2

# 1. ãƒ‡ãƒ¢ã§ä»•çµ„ã¿ã‚’ç†è§£
python demo_hybrid_mode.py

# 2. è‡ªå‹•ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼
python test_generated_code.py

# 3. ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ
python compare_providers.py dummy
```

### APIã‚­ãƒ¼ã‚ã‚Šã§ãƒ†ã‚¹ãƒˆ
```bash
cd runtime/v0.2

# 1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install anthropic

# 2. APIã‚­ãƒ¼è¨­å®š
export ANTHROPIC_API_KEY="sk-ant-..."

# 3. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
python test_hybrid_mode.py

# 4. ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ
python compare_providers.py dummy anthropic
```

## ğŸ“ æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆï¼š

```bash
# 1. ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
python -m ikdd.cli \
  --tool tool.yaml \
  --knowledge knowledge.yaml \
  --provider anthropic \
  --outdir generated

# 2. ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
cat generated/csv_filter_exporter.py

# 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
cat > test.csv << EOF
name,score,category
Alice,85,A
Bob,45,B
Charlie,92,A
EOF

# 4. å®Ÿè¡Œ
python -c "
from generated.csv_filter_exporter import csv_filter_exporter
csv_filter_exporter('test.csv', 'score', 50, 'output.json')
"

# 5. çµæœç¢ºèª
cat output.json
```

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹çµæœ

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šéã™ã‚‹ã¨ï¼š

```
âœ… ã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸ
âœ… CDDåˆ¶ç´„ã‚’ã™ã¹ã¦æº€ãŸã™
âœ… ç”Ÿæˆã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã‚‹
âœ… æœŸå¾…é€šã‚Šã®å‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã‚‹
```

ã“ã‚Œã«ã‚ˆã‚Šã€**ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ + AI + åˆ¶ç´„æ¤œè¨¼**ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### anthropicãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„
```bash
pip install anthropic
```

### APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼
```bash
# APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
echo $ANTHROPIC_API_KEY

# è¨­å®šã•ã‚Œã¦ã„ãªã‘ã‚Œã°è¨­å®š
export ANTHROPIC_API_KEY="your-key-here"
```

### åˆ¶ç´„é•åã‚¨ãƒ©ãƒ¼
- tool.yamlã¨knowledge.yamlã®æ•´åˆæ€§ã‚’ç¢ºèª
- must_useã®è­˜åˆ¥å­ãŒknowledge.yamlã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
- flowã®å®šç¾©ãŒæ­£ã—ã„ã‹ç¢ºèª

## ğŸ“š å‚è€ƒè³‡æ–™

- Anthropic API: https://console.anthropic.com/
- Claude API Docs: https://docs.anthropic.com/
- IKDD Concept: `../../docs/ikdd-cdd-concept.md`

---

**ğŸ’¡ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®æœ¬è³ªã¯ã€**äººé–“ã®çŸ¥è­˜ï¼ˆknowledgeï¼‰ã¨AIã®èƒ½åŠ›ã‚’çµ„ã¿åˆã‚ã›ã€åˆ¶ç´„ï¼ˆCDDï¼‰ã§å“è³ªã‚’ä¿è¨¼ã™ã‚‹**ã“ã¨ã§ã™ã€‚

- äººé–“ï¼šãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- AIï¼šæŸ”è»Ÿãªå®Ÿè£…ã¨ã‚¢ãƒ€ãƒ—ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- CDDï¼šå“è³ªä¿è¨¼ã¨ä¸€è²«æ€§

ã“ã®3ã¤ãŒçµ„ã¿åˆã‚ã•ã‚‹ã“ã¨ã§ã€é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ç”ŸæˆãŒå®Ÿç¾ã—ã¾ã™ã€‚
